<style>
  body {
    background-image: url('assets/fondo.JPG');
    background-size: cover;
    height: 100vh;
    display: flex;
    justify-content: right;
    align-items: right;
  }

  .title {
    position: absolute;
    top: 10px;
    left: 0;
    z-index: 1000;
    padding: 20px;
  }

  .title h1 {
    font-size: 45px;
    font-weight: bold;
    color: #000000;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5), 0 0 10px rgba(0, 0, 0, 0.3);
    margin: 0;
  }

  .title p {
    font-size: 20px;
    font-weight: 400;
    color: #000000;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5), 0 0 10px rgba(0, 0, 0, 0.3);
    margin: 10px 0 0 0;
  }
</style>



<body>


  <div class="container">


      <div class="title">
        <h1>GeoPortal San Juan de Lurigancho</h1>
        <p>Sistema de Información Geográfica para el Distrito de San Juan de Lurigancho</p>
      </div>
    </div>


  <div class="login-wrapper" fxLayout="row" fxLayoutAlign="center center">
    <mat-card class="box">
      <mat-card-header>


          <img src="assets/logomsjl.jpg" alt="Logo" class="logo-img" style="width: 100%; height: 100%;">

      </mat-card-header>
      <br>
      <form class="form-group" [formGroup]="_formulario" (ngSubmit)="login()" #loginForm="ngForm">
        <mat-card-content>
          <!-- Campos de usuario y contraseña (primera fase) -->
          <div *ngIf="!showCodeInput()">
            <mat-form-field class="example-full-width" appearance="fill">
              <mat-label style="font-weight: bold;">USUARIO</mat-label>
              <mat-icon matPrefix>person</mat-icon>
              <input matInput type="text" name="username" formControlName="username"
                 placeholder="Usuario Administrador"
                [(ngModel)]="username" class="username" maxlength="60" />
              <mat-error *ngIf="_formulario.get('username')?.hasError('required')">
                El usuario es requerido
              </mat-error>
            </mat-form-field>
            <mat-form-field class="example-full-width" appearance="fill">
              <mat-label style="font-weight: bold;">CONTRASEÑA</mat-label>
              <mat-icon matPrefix>lock</mat-icon>
              <input matInput type="password" formControlName="password" name="password"
                placeholder="Contraseña" [(ngModel)]="password" class="password"
                required minlength="8" maxlength="30" />
              <mat-error *ngIf="_formulario.get('password')?.hasError('required')">
                La contraseña es requerida
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Campo de código de acceso (segunda fase) -->
          <div *ngIf="showCodeInput()">
            <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px; margin-bottom: 20px;">
              <p style="color: #fff; margin-bottom: 10px;">Código de acceso generado:</p>
              <h2 style="font-family: 'Courier New', monospace; font-size: 28px; color: #4A90E2; letter-spacing: 2px; margin: 10px 0;">
                {{ accessCodeValue() }}
              </h2>
              <p style="color: rgba(255,255,255,0.8); font-size: 14px; margin-top: 10px;">Ingrese este código para continuar</p>
            </div>
            <mat-form-field class="example-full-width" appearance="fill">
              <mat-label style="font-weight: bold;">CÓDIGO DE ACCESO</mat-label>
              <mat-icon matPrefix>vpn_key</mat-icon>
              <input matInput type="text" formControlName="accessCode" name="accessCode"
                placeholder="Ej: 2025$1223" [(ngModel)]="accessCode" class="access-code" />
              <mat-error *ngIf="_formulario.get('accessCode')?.hasError('required')">
                El código de acceso es requerido
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Mensajes de error -->
          <div *ngIf="error" style="color: #ff6b6b; padding: 10px; background: rgba(255,107,107,0.1); border-radius: 4px; margin-bottom: 10px; font-size: 14px;">
            <mat-icon style="vertical-align: middle; font-size: 18px; width: 18px; height: 18px;">error</mat-icon>
            {{ error }}
          </div>

          <!-- Botones -->
          <button mat-raised-button type="submit" class="add" [disabled]="_formulario.invalid || loading()">
            <mat-spinner *ngIf="loading()" diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
            <span *ngIf="!loading()">
              {{ showCodeInput() ? 'Verificar Código' : 'Iniciar Sesión' }}
            </span>
            <mat-icon *ngIf="!loading()">{{ showCodeInput() ? 'check' : 'arrow_forward' }}</mat-icon>
          </button>

          <button *ngIf="showCodeInput()" mat-raised-button type="button" class="volver" (click)="resetForm()">
            Volver
            <mat-icon>arrow_back</mat-icon>
          </button>

          <button *ngIf="!showCodeInput()" mat-raised-button type="button" class="volver" (click)="volverAPaginaPrincipal()">
            Volver al Geoportal
            <mat-icon>arrow_back</mat-icon>
          </button>
        </mat-card-content>
      </form>
      <a mat-button style="color: rgb(255, 254, 254);" href="#" target="_blank"> ¿Has olvidado la
        contraseña?</a>
    </mat-card>
  </div>


  <div class="footer">
    <footer>
      <div class="footer-content">
        <div class="footer-text">
          <span class="footer-entity">Municipalidad Distrital de San Juan de Lurigancho</span>
          <span class="footer-divider">|</span>
          <span class="footer-system">Sistema GeoPortal de Información v{{version}}</span>
          <span class="footer-divider">|</span>
          <span class="footer-year">© {{year}}</span>
          <span class="footer-system"> Todos los derechos reservados</span>
        </div>

      </div>
    </footer>
  </div>
</body>


<mat-card *ngIf="message">{{message}}</mat-card>
<mat-card *ngIf="error">{{error}}</mat-card>
