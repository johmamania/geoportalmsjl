<div class="geojson-container">
  <!-- Menú lateral de selección de capas -->
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav #sidenav mode="side" position="start" [opened]="menuOpen()" class="layers-sidenav">
      <div class="sidenav-header">
        <h2>Capas GeoJSON</h2>
        <button mat-icon-button (click)="toggleMenu()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <mat-divider></mat-divider>
      <div class="sidenav-content">
        <mat-list>
          <mat-list-item *ngFor="let layer of visibleGeoJsonLayers"
                         class="layer-list-item"
                         [class.layer-selected]="isLayerVisible(layer.id)"
                         (click)="toggleLayer(layer.id)">
            <div class="layer-item">
              <div class="layer-circle" [class.circle-selected]="isLayerVisible(layer.id)"></div>
              <img [src]="layer.icon" [alt]="layer.name" class="layer-icon">
              <span>{{ layer.name }}</span>
            </div>
          </mat-list-item>
        </mat-list>
      </div>
    </mat-sidenav>

    <mat-sidenav-content>
      <!-- Toolbar superior -->
      <div class="toolbar">
        <div class="toolbar-left">
          <button mat-icon-button (click)="toggleMenu()"
          matTooltip="Mostrar/Ocultar Menú"
          class="menu-toggle-btn"
          [class.menu-open]="menuOpen()"
          [class.menu-closed]="!menuOpen()">
            <mat-icon>menu</mat-icon>
          </button>
          <button mat-icon-button (click)="irAMiUbicacion()"
          matTooltip="Mi ubicación"
          class="menu-toggle-btn location-btn">
            <mat-icon>location_on</mat-icon>
          </button>
          <h1 class="toolbar-title"> </h1>
        </div>
        <div class="toolbar-right">
          <!-- Contenedor unificado para PC y móvil -->
          <div class="map-type-container">
            <div class="map-type-name">
              <mat-icon class="map-type-icon">{{ getCurrentMapTypeIcon() }}</mat-icon>
              <span class="map-type-text">{{ getCurrentMapTypeName() }}</span>
            </div>
            <div class="map-type-icons">
              <button mat-icon-button
                      *ngFor="let mapType of mapTypes"
                      (click)="changeMapType(mapType.id)"
                      [class.active]="selectedMapType() === mapType.id"
                      [matTooltip]="mapType.name"
                      class="map-type-icon-btn">
                <mat-icon>{{ mapType.icon }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Contenedor principal -->
      <div class="main-content">
        <!-- Panel de lista de ubicaciones -->
        <div class="list-panel">
          <div class="list-header">
            <h3>Ubicaciones Cargadas</h3>
            <span class="count-badge">{{ featuresList.length }}</span>
          </div>
          <div class="list-content">
            <div *ngIf="featuresList.length === 0" class="empty-state">
              <mat-icon>map</mat-icon>
              <p>No hay ubicaciones cargadas</p>
              <p class="hint">Selecciona una capa del menú para comenzar</p>
            </div>

            <div *ngIf="featuresList.length > 0" class="features-list">
              <div
                *ngFor="let featureItem of featuresList; let i = index"
                class="feature-item"
                (click)="locateOnMap(featureItem)">
                <div class="feature-icon">
                  <img [src]="featureItem.icon" [alt]="featureItem.layerName">
                </div>
                <div class="feature-info">
                  <div class="feature-name">{{ getFeatureName(featureItem.feature) }}</div>
                  <div class="feature-layer">{{ featureItem.layerName }}</div>
                </div>
                <mat-icon class="locate-icon">location_on</mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Mapa -->
        <div class="map-container">
          <div id="geojson-map" class="map"></div>
          <!-- Botón de leyenda -->
          <button mat-fab
                  class="legend-button"
                  (click)="toggleLegend()"
                  matTooltip="Leyenda de Ubicaciones"
                  color="primary">
            <mat-icon>info</mat-icon>
          </button>
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>

  <!-- Popup de Leyenda -->
  <div class="legend-popup" *ngIf="showLegend()">
    <div class="legend-header">
      <h3>Tipos de Ubicación</h3>
      <button mat-icon-button (click)="toggleLegend()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="legend-content">
      <div class="legend-table">
        <div class="legend-row" *ngFor="let layer of allGeoJsonLayers">
          <div class="legend-icon-cell">
            <img [src]="layer.icon" [alt]="layer.name" class="legend-icon-img">
          </div>
          <div class="legend-name-cell">
            <span>{{ layer.name }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="legend-overlay" *ngIf="showLegend()" (click)="toggleLegend()"></div>
</div>

